events {}
http {
    upstream frontend { server frontend:80; }
    upstream backend { server backend:3000; }
    upstream mongo_ui { server mongo-express:8081; }

    server {
        listen 80;
        return 301 https://$host$request_uri;
    }

    server {
        listen 443 ssl;
        ssl_certificate /etc/nginx/certs/localhost.crt;
        ssl_certificate_key /etc/nginx/certs/localhost.key;

        location / { proxy_pass http://frontend; }
        location /api/ { proxy_pass http://backend; }
        location /db/ { proxy_pass http://mongo_ui; }
    }
}
